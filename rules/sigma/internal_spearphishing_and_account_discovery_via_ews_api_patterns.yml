title: Internal Spearphishing and Account Discovery via EWS API Patterns
id: 2700b3bf-b22b-40c8-847d-00f731464e79
status: experimental
description: Detects potential internal spearphishing and account discovery activity by monitoring for specific logon patterns and service interactions associated with Exchange Web Services (EWS) abuse. Attackers use compromised accounts to enumerate mailboxes (ResolveNames, GetDelegate) and send malicious internal emails to move laterally, often associated with CVE-2023-23397 exploitation.
author: DetectForge
date: 2026/02/11
modified: 2026/02/11
tags:
  - attack.lateral_movement
  - attack.t1534
  - attack.discovery
  - attack.t1087
logsource:
  product: windows
  service: security
detection:
  selection_ews_logon:
    EventID:
      - 4624
    LogonType:
      - 3
    ProcessName:
      - "*\\w3wp.exe"
      - "*\\Microsoft.Exchange.ServiceHost.exe"
  selection_suspicious_ips:
    IpAddress:
      - 101.255.119.42
      - 213.32.252.221
      - 168.205.200.55
      - 185.132.17.160
      - 69.162.253.21
      - 113.160.234.229
      - 181.209.99.204
      - 82.196.113.102
      - 85.195.206.7
      - 61.14.68.33
  selection_service_access:
    EventID:
      - 4674
    ServiceName:
      - "*Exchange*"
      - "*EWS*"
  filter_legitimate_dc:
    SubjectUserName:
      - ANONYMOUS LOGON
      - MSOL_*
    IpAddress:
      - 127.0.0.1
      - ::1
  filter_health_mailboxes:
    TargetUserName:
      - HealthMailbox*
  condition: (selection_ews_logon and selection_suspicious_ips) or (selection_service_access and not (filter_legitimate_dc or filter_health_mailboxes))
falsepositives:
  - Legitimate administrative scripts or third-party backup solutions using EWS to sync or migrate mailbox data.
  - Internal security scanners or mail flow monitoring tools that simulate user logins to verify Exchange availability.
  - Mobile device management (MDM) solutions or mail clients performing legitimate synchronization from known external IP ranges.
level: high

title: Suspicious Exchange Mailbox Permission Manipulation via EWS
id: 45fc7da8-ffe5-4291-b9c9-9349bb89b874
status: experimental
description: Detects potential persistence activity where an attacker modifies Exchange mailbox folder permissions using the UpdateFolder EWS API. This behavior is often seen after NTLM relay attacks or CVE-2023-23397 exploitation to grant 'Owner' or 'Anonymous' access to mailboxes, allowing persistent access even after password resets.
author: DetectForge
date: 2026/02/11
modified: 2026/02/11
tags:
  - attack.persistence
  - attack.t1098.002
logsource:
  product: windows
  service: security
detection:
  selection_ews_access:
    EventID:
      - 4624
    LogonType:
      - 3
    ProcessName:
      - "*\\w3wp.exe"
  selection_suspicious_ips:
    IpAddress:
      - 101.255.119.42
      - 213.32.252.221
      - 168.205.200.55
      - 185.132.17.160
      - 69.162.253.21
      - 113.160.234.229
      - 181.209.99.204
      - 82.196.113.102
      - 85.195.206.7
      - 61.14.68.33
  filter_internal_networks:
    IpAddress:
      - 127.0.0.1
      - ::1
      - 10.*
      - 192.168.*
      - 172.16.*
      - 172.17.*
      - 172.18.*
      - 172.19.*
      - 172.20.*
      - 172.21.*
      - 172.22.*
      - 172.23.*
      - 172.24.*
      - 172.25.*
      - 172.26.*
      - 172.27.*
      - 172.28.*
      - 172.29.*
      - 172.30.*
      - 172.31.*
  condition: selection_ews_access and (selection_suspicious_ips or not filter_internal_networks)
falsepositives:
  - Legitimate administrative access from authorized external IP addresses (e.g., remote IT support using EWS-based tools)
  - Third-party SaaS backup or migration solutions that utilize EWS to access and modify mailbox permissions
level: high

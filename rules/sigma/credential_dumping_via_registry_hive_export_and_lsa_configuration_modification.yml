title: Credential Dumping via Registry Hive Export and LSA Configuration Modification
id: 25d1354f-f092-4e36-a7d2-3a0ee33a59d0
status: experimental
description: Detects attempts to export sensitive registry hives (SAM, SECURITY, SYSTEM) using reg.exe or modifying LSA configuration to enable legacy LM hash storage. These actions are common precursors to credential extraction using tools like Mimikatz.
author: DetectForge
date: 2026/02/11
modified: 2026/02/11
tags:
  - attack.credential_access
  - attack.t1003.001
  - attack.t1003.002
logsource:
  product: windows
  category: process_creation
detection:
  selection_registry_export:
    CommandLine:
      - "*reg* save *HKLM\\SAM*"
      - "*reg* save *HKLM\\SECURITY*"
      - "*reg* save *HKLM\\SYSTEM*"
      - "*reg* export *HKLM\\SAM*"
      - "*reg* export *HKLM\\SECURITY*"
      - "*reg* export *HKLM\\SYSTEM*"
  selection_lsa_modification:
    CommandLine:
      - "*NoLMHash* /t REG_DWORD /d 0*"
      - "*DisableRestrictedAdmin* /t REG_DWORD /d 0*"
  selection_staging:
    CommandLine:
      - "*Compress-Archive*\\Windows\\Temp\\*"
      - "*7z*\\Windows\\Temp\\*.zip*"
      - "*rar*\\Windows\\Temp\\*.zip*"
  filter_legitimate_backups:
    ParentImage:
      - C:\Windows\System32\wbem\WmiPrvSE.exe
      - C:\Program Files\BackupAgent\*
    User:
      - NT AUTHORITY\SYSTEM
  condition: (selection_registry_export or selection_lsa_modification or selection_staging) and not filter_legitimate_backups
falsepositives:
  - Legitimate backup software or scripts performing system state backups
  - System administrators manually backing up registry keys before performing sensitive configuration changes
  - Security auditing tools performing authorized credential assessments
level: high

title: Suspicious NTDS.DIT Extraction and LSASS Dumping via Task Manager
id: 43241ba3-5a37-4e64-bce6-6476a6e86f85
status: experimental
description: Detects patterns of credential dumping including the compression of the Active Directory database (ntds.dit) and the creation of LSASS memory dumps using Task Manager. This behavior is consistent with post-exploitation activities where attackers attempt to harvest credentials for lateral movement.
author: DetectForge
date: 2026/02/11
modified: 2026/02/11
tags:
  - attack.credential_access
  - attack.t1003.001
  - attack.t1003.003
logsource:
  product: windows
  category: process_creation
detection:
  selection_lsass_target:
    CommandLine|contains: "lsass"
  selection_lsass_dump_pattern:
    CommandLine|contains:
      - ".dmp"
      - "dump"
      - "minidump"
      - "procdump"
  selection_ntds_compression:
    CommandLine|contains: "ntds"
  selection_ntds_specific_tools:
    Image|endswith:
      - "\\7z.exe"
      - "\\7za.exe"
      - "\\rar.exe"
      - "\\zip.exe"
    CommandLine|contains: "ntds.dit"
  selection_ntdsutil_image:
    Image|endswith: "\\ntdsutil.exe"
  selection_vssadmin_shadow:
    Image|endswith: "\\vssadmin.exe"
    CommandLine|contains: "shadow"
  selection_vhd_mount:
    Image|endswith:
      - "\\powershell.exe"
      - "\\pwsh.exe"
    CommandLine|contains:
      - "Mount-VHD"
      - "Mount-DiskImage"
  selection_parent_encoded_ps:
    ParentImage|endswith:
      - "\\powershell.exe"
      - "\\pwsh.exe"
    ParentCommandLine|contains:
      - "-enc"
      - "-encodedcommand"
  filter_legitimate_backup:
    Company:
      - Veeam Software*
      - Microsoft Corporation
    CommandLine|contains:
      - "\\Backup\\"
      - "\\Veeam\\"
  condition: ((selection_lsass_target and selection_lsass_dump_pattern) or selection_ntds_compression or selection_ntds_specific_tools or selection_ntdsutil_image or selection_vssadmin_shadow or selection_vhd_mount or (selection_parent_encoded_ps and (selection_lsass_target or selection_ntds_compression))) and not filter_legitimate_backup
falsepositives:
  - Legitimate backup software or scripts that compress the Active Directory database for offsite storage.
  - Administrators manually mounting VHD files for disaster recovery testing or maintenance.
  - Antivirus or EDR solutions generating memory dumps for diagnostic purposes.
level: high

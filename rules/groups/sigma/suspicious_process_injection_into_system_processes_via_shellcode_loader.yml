title: Suspicious Process Injection into System Processes via Shellcode Loader
id: d78f5d70-f208-473a-ac84-708016d215d5
status: experimental
description: Detects suspicious process relationships and command-line patterns indicative of shellcode injection into system processes like taskhost.exe or sihost.exe. This behavior aligns with TTPs where NtMapViewOfSection and NtSetContextThread are used to redirect execution flow in a suspended state.
author: DetectForge
date: 2026/02/11
modified: 2026/02/11
tags:
  - attack.defense_evasion
  - attack.t1055.001
logsource:
  product: windows
  category: process_creation
detection:
  selection_targets:
    Image:
      - "*\\taskhost.exe"
      - "*\\sihost.exe"
      - "*\\taskhostw.exe"
  selection_suspicious_parents:
    ParentImage:
      - "*\\Users\\*"
      - "*\\Downloads\\*"
      - "*\\Temp\\*"
      - "*\\AppData\\*"
    ParentCommandLine:
      - "*.exe*"
      - "*powershell*"
      - "*cmd.exe /c*"
  filter_legitimate_system:
    ParentImage:
      - "*\\Windows\\System32\\services.exe"
      - "*\\Windows\\System32\\svchost.exe"
      - "*\\Windows\\System32\\winlogon.exe"
    IntegrityLevel:
      - System
  filter_user_init:
    ParentCommandLine:
      - "*C:\\Windows\\system32\\userinit.exe*"
  condition: selection_targets and selection_suspicious_parents and not (filter_legitimate_system or filter_user_init)
falsepositives:
  - Legitimate system initialization processes where taskhost.exe is spawned by a user-mode process during login
  - Security software or management agents that perform legitimate monitoring or injection for diagnostic purposes
level: high

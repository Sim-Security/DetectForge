title: Suspicious OAuth Token Extraction via Process Command Line
id: 14c3683f-1999-410f-96f2-3514e40b6cb6
status: experimental
description: Detects the use of command-line tools and parameters associated with the extraction or manipulation of OAuth and application access tokens. SVR actors and infostealers often target token caches (like those used by Azure CLI, MSAL, or browsers) to bypass MFA and maintain persistent access via token replay.
author: DetectForge
date: 2026/02/10
modified: 2026/02/10
tags:
  - attack.defense_evasion
  - attack.t1550.001
  - attack.credential_access
  - attack.t1539
logsource:
  product: windows
  category: process_creation
detection:
  selection_cli_tools:
    CommandLine:
      - "*Get-AzAccessToken*"
      - "*az account get-access-token*"
      - "*msal.cache*"
      - "*.Identity.Service/AdalCache*"
      - "*Microsoft/TokenBroker*"
      - "*--get-access-token*"
      - "*Connect-MgGraph*Scopes*"
  selection_infostealer_behavior:
    CommandLine:
      - "*\\Local Extension Settings\\*"
      - "*\\Local Storage\\leveldb*"
      - "*\\Identity.Service\\*"
    ParentImage:
      - "*\\powershell.exe"
      - "*\\pwsh.exe"
      - "*\\cmd.exe"
      - "*\\cscript.exe"
      - "*\\wscript.exe"
  filter_legitimate_admin:
    User:
      - NT AUTHORITY\SYSTEM
    CommandLine:
      - "*Program Files*"
      - "*Windows\\System32\\*"
  condition: (selection_cli_tools or selection_infostealer_behavior) and not filter_legitimate_admin
falsepositives:
  - Legitimate administrative scripts using Azure CLI or Microsoft Graph PowerShell modules for automation
  - Developers debugging OAuth flows or local application authentication
  - Software inventory or backup agents accessing application data directories
level: high
